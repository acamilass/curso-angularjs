<!DOCTYPE html>
<html ng-app="meuModulo">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Curso AngularJS</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
</head>

<body ng-controller="indexController">
	<header class="container">
		<h2 ng-bind="titulo"></h2>
	</header>
	<main class="container">
		<div class="row">
			<input type="text" ng-model="busca.nome" placeholder="Busca">
		</div>
		<div class="row">
			<table class="striped">
				<thead>
					<tr>
						<th>Nome</th>
						<th>E-mail</th>
						<th>Nota 1</th>
						<th>Nota 2</th>
						<th>Nota 3</th>
						<th>Média</th>
						<th>Ação</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="aluno in alunos | filter:busca">
						<td>{{ aluno.nome }}</td>
						<td>{{ aluno.email }}</td>
						<td>{{ aluno.nota1 }}</td>
						<td>{{ aluno.nota2 }}</td>
						<td>{{ aluno.nota3 }}</td>
						<td>{{ aluno.media }}</td>
						<td>
							<a class="waves-effect waves-light btn modal-trigger" ng-click="editarAluno(aluno)" href="#modal1">Editar</a>
							<a class="waves-effect waves-light btn red" ng-click="deletarAluno(aluno)">Deletar</a>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="row">
			<a ng-click="edicao=false" class="waves-effect waves-light btn modal-trigger" href="#modal1">Adicionar</a>
		</div>
	</main>

	<!-- Modal Structure -->
	<div id="modal1" class="modal modal-fixed-footer">
		<div class="modal-content">
			<h4 ng-if="!edicao">Adicionar aluno</h4>
			<h4 ng-if="edicao">Editar aluno</h4>
			<p>Preencha os dados do aluno</p>
			<div class="row">
				<div class="input-field col m6 s12">
					<input type="text" ng-model="aluno.nome" class="validate" placeholder="Nome">
				</div>
				<div class="input-field col m6 s12">
					<input type="email" ng-model="aluno.email" class="validate" placeholder="E-mail">
				</div>
			</div>
			<div class="row">
				<div class="input-field col m4 s12">
					<input type="number" ng-model="aluno.nota1" class="validate" placeholder="Nota 1">
				</div>
				<div class="input-field col m4 s12">
					<input type="number" ng-model="aluno.nota2" class="validate" placeholder="Nota 2">
				</div>
				<div class="input-field col m4 s12">
					<input type="number" ng-model="aluno.nota3" class="validate" placeholder="Nota 3">
				</div>
			</div>
		</div>
		<div class="modal-footer">
			<a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancelar</a>
			<a ng-if="!edicao" class="modal-close waves-effect waves-light btn blue" ng-click="addAluno(aluno)">Adicionar</a>
			<a ng-if="edicao" class="modal-close waves-effect waves-light btn blue" ng-click="salvarAluno(aluno)">Salvar</a>
		</div>
	</div>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
	<script src="lib/angular/angular.min.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			var elems = document.querySelectorAll('.modal');
			var instances = M.Modal.init(elems);
		});
	</script>
	<script>
		angular.module('meuModulo', [])
			.controller('indexController', function ($scope) {
				$scope.titulo = 'Sistema com AngularJS';
				$scope.alunos = [
					{ nome: 'Camila', email: 'camila@mail.com', nota1: 65, nota2: 80, nota3: 55 },
					{ nome: 'Cristina', email: 'cristina@mail.com', nota1: 75, nota2: 80, nota3: 55 },
					{ nome: 'Clara', email: 'clara@mail.com', nota1: 65, nota2: 60, nota3: 55 },
					{ nome: 'Carol', email: 'carol@mail.com', nota1: 95, nota2: 30, nota3: 55 }
				];

				$scope.edicao = false;

				var init = function () {
					$scope.alunos.forEach(function (aluno) {
						aluno.media = media(aluno);
					});
					reset();
				}

				var media = function (aluno) {
					const media = (aluno.nota1 + aluno.nota2 + aluno.nota3) / 3;
					return media.toFixed(1);
				};

				$scope.addAluno = function(aluno) {
					$scope.edicao = false;
					aluno.media = media(aluno);
					$scope.alunos.push(aluno);
					reset();
				};

				var alunoEditar;

				$scope.editarAluno = function(aluno) {
					$scope.edicao = true;
					angular.copy(aluno, $scope.aluno);
					alunoEditar = aluno;
				}

				$scope.salvarAluno = function(aluno) {
					alunoEditar.nome = aluno.nome;
					alunoEditar.email = aluno.email;
					alunoEditar.nota1 = aluno.nota1;
					alunoEditar.nota2 = aluno.nota2;
					alunoEditar.nota3 = aluno.nota3;
					alunoEditar.media = media(aluno);
					reset();
				};

				$scope.deletarAluno = function(aluno) {
					for(var i in $scope.alunos) {
						var aux = $scope.alunos[i];
						if (aluno === aux) {
							$scope.alunos.splice(i, 1);
						}
					}
				};

				var reset = function() {
					$scope.aluno = { nome: '', email: '', nota1: null, nota2: null, nota3: null, media: null };
				};

				init();
			});
	</script>
</body>

</html>